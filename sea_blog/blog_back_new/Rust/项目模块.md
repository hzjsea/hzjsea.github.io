---
title: é¡¹ç›®æ¨¡å—
date: 2021-03-15 16:00:13
categories:  [rust]
tags: [rust]
---


<!--more-->


# é¡¹ç›®æ¨¡å—
é¡¹ç›®æ¨¡å—åªè¦æ˜¯æ¥ç®¡ç†é¡¹ç›®ï¼Œå°†é¡¹ç›®ä¸­å¯å…±äº«çš„æ¨¡å—åŒºåˆ†å¼€æ¥ã€‚


## æ¨¡å—ç®¡ç†
å¯ä»¥å…ˆçœ‹ä¸‹é¢çš„é¡¹ç›®
Rustçš„æ¨¡å—å°±æ˜¯å‘½åç©ºé—´ï¼Œç”¨å…³é”®è¯modè¡¨ç¤ºã€‚å®ƒçš„ä½œç”¨æ˜¯æŠŠä¸€ä¸ªcrateçš„ä»£ç åˆ’åˆ†æˆå¯ç®¡ç†çš„éƒ¨åˆ†ã€‚æ¯ä¸€ä¸ªcrateéƒ½æœ‰ä¸€ä¸ªé¡¶å±‚çš„åŒ¿åæ ¹å‘½åç©ºé—´, æ ¹ç©ºé—´ä¸‹é¢çš„å‘½åç©ºé—´å¯ä»¥ä»»æ„åµŒå¥—ï¼Œè¿™æ ·æ„æˆä¸€ä¸ªæ ‘å½¢ç»“æ„

```rust
// good_bye/src/lib.rs
pub fn say(){
    println!("good bye")    
}


pub mod xxer{
    fn echo(){
        println!("echo")
    }

    pub fn echo_pub(){
        echo()
    }
}
```

```rust
// main.rs
extern crate good_bye;
fn main() {
    println!("Hello, world!");
    good_bye::say();
    good_bye::xxer::echo_pub();
    good_bye::xxer::echo(); // error , because not public
}
```

### modåˆ†å±‚

> æŠŠå¤šä¸ªæ¨¡å—å†™åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸‹é¢

```rust
// lib.rs
mod caller {
    fn call() {}
}
mod worker {
    fn work1() {}
    fn work2() {}
    fn work3() {}
}
```

> æŠŠå¤šä¸ªæ¨¡å—å†™åˆ°å¤šä¸ªæ–‡ä»¶ä¸‹é¢

```rust
// <lib.rs>
mod caller;
mod worker;
// <caller.rs>
fn call() {}// <worker.rs>
fn work1() {}
fn work2() {}
fn work3() {}
```

> æŠŠå¤šä¸ªæ¨¡å—å†™åˆ°å¤šä¸ªæ–‡ä»¶å¤¹ä¸‹é¢

```rust
// <lib.rs>
mod caller;
mod worker;
// <caller.rs>
fn call() {}
// <worker/mod.rs>
mod worker1;
mod worker2;
mod worker3;
// <worker/worker1.rs>
fn work1() {}
// <worker/worker2.rs>
fn work2() {}
// <worker/worker3.rs>
fn work3() {}
```

### ç§æœ‰ä¸å æœ‰
rustä¸­çš„å¼•ç”¨åªè¦è·¯åŠ²å¯è¾¾ï¼Œå°±å¯ä»¥ä½¿ç”¨ï¼Œä¸€ä¸ªmodä¸‹é¢æœ‰å¤šä¸ªæ–¹æ³•ï¼Œ å‡è®¾è¿™ä¸ªmodä¸‹é¢çš„æ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯public,ä½†æ˜¯modæ˜¯ç§æœ‰çš„ï¼Œåˆ™è·¯å¾„ä¸å¯è¾¾ï¼Œä¸èƒ½ä½¿ç”¨



## å°é¡¹ç›®æ¡ˆä¾‹
rustä¸­æœ‰ä¸¤ä¸ªé¡¹ç›®ç»“æ„æœ‰ä¸¤ä¸ªæ¦‚å¿µï¼Œä¸€ä¸ªæ˜¯create,å¦ä¸€ä¸ªæ˜¯mod,ä¸€ä¸ªcreateæ˜¯ä¸€ä¸ªå®Œæ•´çš„ç¼–è¯‘å•å…ƒï¼Œ
modä¹‹é—´å¯ä»¥äº’ç›¸è°ƒç”¨æ–¹æ³•ï¼Œcrateä¹‹é—´ä¸èƒ½å‡ºç°å¾ªç¯å¼•ç”¨

åˆ›å»ºä¸€ä¸ªå·¥ç¨‹æ–‡ä»¶å¤¹
```bash
# åˆ›å»ºé¡¹ç›®
mkdir workspace
# åˆ›å»ºå·¥ç¨‹æ–‡ä»¶ --bin åˆ›å»ºçš„æ˜¯main.rs --lib åˆ›å»ºçš„æ˜¯lib.rs
cargo new helloworld --bin
cargo new goodbye --lib
```
çœ‹ä¸‹ç›®å½•ç»“æ„
```bash
ğŸƒ:rust/ $ tree  -L 3
.
â”œâ”€â”€ goodbye   # æœ¬åœ°åŒ…
â”‚Â Â  â”œâ”€â”€ Cargo.toml
â”‚Â Â  â””â”€â”€ src
â”‚Â Â      â””â”€â”€ lib.rs
â””â”€â”€ helloworld  # é¡¹ç›®ä¸»æ–‡ä»¶å¤¹
    â”œâ”€â”€ Cargo.lock
    â”œâ”€â”€ Cargo.toml
    â”œâ”€â”€ src
    â”‚Â Â  â””â”€â”€ main.rs
    â””â”€â”€ target
        â”œâ”€â”€ debug
        â””â”€â”€ rls
```

ç¼–å†™æœ¬åœ°åŒ…ä¸­çš„å†…å®¹
```rust
// åœ¨goodbye/src/libä¸‹é¢å†™ä¸Šå¦‚ä¸‹ä»£ç 
pub fn say(){
    println!("good bye")    
}
```
åœ¨ä¸»åŒ…helloworldä¸­è°ƒç”¨
```rust
// helloworld/Cargo.toml

[dependencies]
goodbye = { path = "../goodbye"}

// helloworld/src/main.rs
extern crate goodbye;
fn main(){
    println!("helloworld");
    goodbye::say();
}
```

> åŠ å¼ºç‰ˆ
```bash
ğŸƒ:rust/ $ tree . -L 3
.
â”œâ”€â”€ goodbye
â”‚Â Â  â”œâ”€â”€ Cargo.lock
â”‚Â Â  â”œâ”€â”€ Cargo.toml
â”‚Â Â  â”œâ”€â”€ src
â”‚Â Â  â”‚Â Â  â””â”€â”€ lib.rs
â”‚Â Â  â””â”€â”€ target
â”‚Â Â      â”œâ”€â”€ debug
â”‚Â Â      â””â”€â”€ rls
â”œâ”€â”€ helloman
â”‚Â Â  â”œâ”€â”€ Cargo.lock
â”‚Â Â  â”œâ”€â”€ Cargo.toml
â”‚Â Â  â”œâ”€â”€ src
â”‚Â Â  â”‚Â Â  â””â”€â”€ lib.rs
â”‚Â Â  â””â”€â”€ target
â”‚Â Â      â”œâ”€â”€ debug
â”‚Â Â      â””â”€â”€ rls
â”œâ”€â”€ hellowoman
â”‚Â Â  â”œâ”€â”€ Cargo.lock
â”‚Â Â  â”œâ”€â”€ Cargo.toml
â”‚Â Â  â”œâ”€â”€ src
â”‚Â Â  â”‚Â Â  â””â”€â”€ lib.rs
â”‚Â Â  â””â”€â”€ target
â”‚Â Â      â””â”€â”€ rls
â”œâ”€â”€ helloworld
â”‚Â Â  â”œâ”€â”€ Cargo.lock
â”‚Â Â  â”œâ”€â”€ Cargo.toml
â”‚Â Â  â”œâ”€â”€ src
â”‚Â Â  â”‚Â Â  â””â”€â”€ main.rs
â”‚Â Â  â””â”€â”€ target
â”‚Â Â      â”œâ”€â”€ debug
â”‚Â Â      â””â”€â”€ rls
```
```rust
// helloworld/Cargo.toml
[dependencies]
goodbye = { path = "../goodbye"}
helloman = { path = "../helloman"}
hellowoman = { path = "../hellowoman"}

// helloworld/main.rs
extern crate goodbye;
extern crate helloman;
extern crate hellowoman;
extern crate hellowoman as woman; // 
fn main(){
    println!("helloworld");
    goodbye::say();
    helloman::sayman();
    hellowoman::saywoman();
}
```

## å¤§é¡¹ç›®æ¡ˆä¾‹
å¤§é¡¹ç›®æ¡ˆä¾‹ä¸­å°±è¦æ¶‰åŠåˆ°workspaceçš„ä½¿ç”¨äº†ï¼Œç”¨ç¬¬ä¸€ä¸ªé¡¹ç›®çš„æ¡ˆä¾‹
```rust
ğŸƒ:workspace/ $ ls -al
total 0
drwxr-xr-x   4 alpaca  staff  128 Mar 15 16:03 .
drwxr-xr-x  16 alpaca  staff  512 Mar 15 16:02 ..
drwxr-xr-x   8 alpaca  staff  256 Mar 15 16:03 good_bye
drwxr-xr-x   8 alpaca  staff  256 Mar 15 16:29 helloworld
ğŸƒ:workspace/ $
```
åˆ›å»ºä¸€ä¸ª`Cargo.toml`
```rust
[workspace]
members = [
        "helloworld",
        "good_bye"
]
```
å†™ä¸Šè¦ç¼–è¯‘çš„æ‰€æœ‰æ–‡ä»¶ä»¶ï¼Œcargo build ä¸€ä¸‹ä¼šåœ¨å½“å‰æ–‡ä»¶å¤¹äº§ç”Ÿä¸€ä¸ªtargetç¼–è¯‘åçš„æ–‡ä»¶ï¼Œä»¥åŠCargo.lockç‰ˆæœ¬æ§åˆ¶çš„æ–‡ä»¶
```rust
ğŸƒ:workspace/ $ ll
total 16
-rw-r--r--  1 alpaca  staff   229B Mar 15 16:37 Cargo.lock
-rw-r--r--  1 alpaca  staff    53B Mar 15 16:39 Cargo.toml
drwxr-xr-x  8 alpaca  staff   256B Mar 15 16:32 good_bye
drwxr-xr-x  8 alpaca  staff   256B Mar 15 16:29 helloworld
drwxr-xr-x  4 alpaca  staff   128B Mar 15 16:32 target
ğŸƒ:workspace/ $
```


## åŒ…ç®¡ç†æ€»ç»“ update

rust å®˜æ–¹çš„åŒ…ç®¡ç†æ€»æ„Ÿè§‰è®²çš„æœ‰ç‚¹ä¹±ï¼Œè‡ªå·±æ‰¾äº†ä¸€ä¸ª github çš„é¡¹ç›®æ€»ç»“ä¸€ä¸‹ï¼Œå¯èƒ½æœ‰ç‚¹é—®é¢˜ï¼Œåé¢é¡¹ç›®è·Ÿè¿›çš„æ—¶å€™å†çœ‹çœ‹æ•ˆæœ

é¦–å…ˆæ˜¯åˆ›å»ºä¸€ä¸ªé¡¹ç›®æ–‡ä»¶å¤¹

```bash
cargo new zz

# é¡¹ç›®ç»“æ„å¦‚ä¸‹
# alpaca:zz/ (masterâœ—) $ tree .                                                                                    [16:21:49]
# .
# â”œâ”€â”€ Cargo.toml
# â””â”€â”€ src
#     â””â”€â”€ main.rs

```

åˆ›å»ºäº†ä¸€ä¸ª main.rs æ–‡ä»¶ `Cargo.toml`æ˜¯ä¸€ä¸ªä¾èµ–æ–‡ä»¶å¤¹ï¼Œå½“ä½ æƒ³è¦å¼•ç”¨ç¬¬ä¸‰æ–¹åº“çš„æ—¶å€™ï¼Œå°±éœ€è¦åœ¨ toml ä¸­å»æ·»åŠ ä¾èµ–

æ¥ä¸‹æ¥æ˜¯åŒ…ç®¡ç†ä¸­çš„ä¸€äº›åè¯ä»‹ç»

### Crate ç®±æ ¹

`Crate` æ¯ä¸€ä¸ªé€šè¿‡ cargo åˆ›å»ºçš„é¡¹ç›®ç§°ä¹‹ä¸ºä¸€ä¸ª Crateï¼Œæ— è®ºæ˜¯ä»¥åº“å½¢å¼(lib.rs)æˆ–è€…æ˜¯äºŒè¿›åˆ¶å½¢å¼(main.rs)ã€‚å…¶ä¸­å”¯ä¸€çš„ rs æ–‡ä»¶ç§°ä¹‹ä¸º Crate rootï¼Œä¹Ÿå«ä½œç®±æ ¹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ª Crate çš„å…¥å£ç‚¹ï¼Œå­æ¨¡å—çš„åŠ è½½ä¹‹ç±»çš„ï¼Œéƒ½åœ¨å¯¹åº”çš„ç®±æ ¹ä¸­æœ‰å£°æ˜ã€‚ å¯¹äºè¿™ä¸ª`Create`ç®±æ ¹ ç³»ç»Ÿçš„æ ‡å‡†åº“ä¹Ÿæœ‰ä¸€ä¸ªç®±æ ¹ï¼Œåä¸º stdï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å¼•ç”¨è¯¥ Crate è€Œä¸å¿…åœ¨ Cargo.toml çš„ä¾èµ–ä¸­æ·»åŠ ï¼Œå› ä¸ºå®‰è£…å¥½ rust ä¹‹åæ ‡å‡†åº“ä¹Ÿå®‰è£…å¥½äº†ï¼Œä¸å¿…ä»ç¬¬ä¸‰æ–¹è¿›è¡Œä¸‹è½½ã€‚å½“æˆ‘ä»¬éœ€è¦åœ¨è‡ªå·±çš„ä¸¤ä¸ªæœ¬åœ°é¡¹ç›®ä¸­äº’ç›¸å¼•ç”¨åŒ…çš„æ—¶å€™ï¼Œå°±éœ€è¦åœ¨`Cargo.toml`ä¸­å»å¼•ç”¨

```rust
[package] 
name = "zz"   // ä¸»é¡¹ç›®æ–‡ä»¶
version = "0.1.0"  // ç‰ˆæœ¬å·
authors = ["hzjsea <hzjsea@gmail.com>"] // ä½œè€…
edition = "2018" // rustç‰ˆæœ¬å·

[dependencies]  // æ‰©å±•åº“
sep_restaurant = { path = "../sep_restaurant" }
```

å¦‚ä¸Šï¼Œæˆ‘ä»¬å¼•ç”¨äº†ä¸€ä¸ªæœ¬åœ°çš„åä¸º `sep_restaurant` çš„ Crateï¼Œè€Œè¯¥åŒ…çš„è·¯å¾„æ˜¯ç›¸å¯¹äº Cargo.toml çš„ã€‚

### mod

æ— è®ºæ˜¯`main.rs`è¿˜æ˜¯`lib.rs`ï¼Œæ‰€æœ‰çš„ mod éƒ½å¿…é¡»å®šä¹‰åœ¨æ ¹ç®±ä¸­
åˆ›å»ºä¸€ä¸ªæ ¹ç®±

```bash
# alpaca:zz/ (masterâœ—) $ ls                                                                         
# Cargo.toml src
alpaca:zz/ (masterâœ—) $ cargo new --lib restaurant              # åˆ›å»ºä¸€ä¸ªæ‰©å±•åº“                                                  
#      Created library `restaurant` package
# alpaca:zz/ (masterâœ—) $ ls                                                                                   
# Cargo.toml restaurant src

alpaca:zz/ (masterâœ—) $ tree .                            # æŸ¥çœ‹å½“å‰è·¯å¾„ä¸‹çš„ç›®å½•ç»“æ„                                                        
# .
# â”œâ”€â”€ Cargo.toml
# â”œâ”€â”€ restaurant
# â”‚Â Â  â”œâ”€â”€ Cargo.toml
# â”‚Â Â  â””â”€â”€ src
# â”‚Â Â      â””â”€â”€ lib.rs
# â””â”€â”€ src
#     â””â”€â”€ main.rs

# 3 directories, 4 files
```

åœ¨`lib.rs`ä¸­æ·»åŠ  mod

```rust
pub mod first_level_mod {
    pub fn hello() {
        println!("hello");
    }
}
```

äºæ˜¯ç›®å½•æ ‘ä¸­çš„ç»“æ„æ˜¯è¿™æ ·çš„

```bash
# é¡¶å±‚  create
# ä¸‹ä¸€å±‚ first_level_mod   --  function : hello()
```

åˆ›å»ºä¸€ä¸ª sub mod

```rust
pub mod first_level_mod {
    pub fn hello() {
        println!("hello");
    }
    mod second_level_mod {
        pub fn world() {
            println!("world")
        }
    }

}
```

äºæ˜¯ ç›®å½•æ ‘æ›´æ–°ä¸º

```bash
# é¡¶å±‚ create
# ä¸‹ä¸€å±‚ first_level_mod -- function : hello()
    # ä¸‹ä¸€å±‚ second_level_mod  -- function : world()
```

### mod ä¸ mod ä¹‹é—´çš„å±‚çº§å…³ç³»

å¯¹äº mod çš„æ•´ä¸ªå®¶æ—æ¥è¯´ï¼Œä»–æœ‰çˆ¶å­å±‚çº§ä¹‹åˆ†ï¼Œå¯¹åº”çš„æƒé™è§„åˆ™å¦‚ä¸‹

- çˆ¶äº² ä¹Ÿå°±æ˜¯ä¸€çº§å±‚ä¹‹é—´çš„æ˜¯æƒé™æ˜¯é€æ˜çš„
- çˆ¶äº²/(å„¿å­,å„¿å­) ä¹Ÿå°±æ˜¯åŒä¸€çº§å±‚ä¸‹é¢çš„å„¿å­å±‚äº’ç›¸ä¹‹é—´ä¹Ÿæ˜¯é€æ˜çš„
- ä¸åŒçº§å±‚ä¸‹é¢çš„å„¿å­ä¹‹é—´æ˜¯ä¸é€æ˜çš„

### å¼•ç”¨æœ¬åœ° create

```bash
rustmod
â”œâ”€â”€ Cargo.toml
â””â”€â”€ src
    â”œâ”€â”€ main.rs
    â”œâ”€â”€ function.rs
    â””â”€â”€ util.rs
xxx
â”œâ”€â”€ Cargo.toml
â””â”€â”€ src
    â””â”€â”€ lib.rs
```

ä¿®æ”¹`rustmod/Cargo.toml`

```rust
[package]
name = "testmod"
version = "0.1.0"
authors = ["Shidong Wang <wsdjeg@outlook.com>"]
edition = "2018"

[dependencies]
xxx = {path= "../xxx" }
```

åœ¨ main.rs ä¸­å¼•ç”¨

```rust
extern crate xxx;
use xxx::xxx_func;
fn main() {
    xxx_func();
}
```

### åŒçº§ç›®å½•ç›¸äº’è®¿é—®

```rust
rustmod
â”œâ”€â”€ Cargo.toml
â””â”€â”€ src
    â”œâ”€â”€ main.rs
    â”œâ”€â”€ function.rs
    â””â”€â”€ util.rs
```

```rust
// rustmod/src/function.rs
use crate::util;
fn hello_function() {
    util::hello_mod();
}
```